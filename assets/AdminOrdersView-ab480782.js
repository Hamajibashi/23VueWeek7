import{_ as M,o as d,c as l,d as e,t as o,g,F as u,h as y,w as $,i as C,j as D,k as P,m as V,l as E,M as f,r as _,a as L,b as N,T as S,e as p,n as j}from"./index-1731e299.js";import{P as B,D as T}from"./DeleteModal-e22c9931.js";const U={props:["tempOrder","updateOrder"],data(){return{order:{},isPaid:!1}},watch:{tempOrder(){this.order=this.tempOrder}}},q={class:"modal-dialog modal-xl",role:"document"},A={class:"modal-content border-0"},F=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"orderModal"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I={class:"modal-body"},z={class:"row"},G={class:"col-md-4"},H=e("h3",null,"用戶資料",-1),J={class:"table"},K={key:0},Q=e("th",{style:{width:"100px"}},"姓名",-1),R=e("th",null,"Email",-1),W=e("th",null,"電話",-1),X=e("th",null,"地址",-1),Y=e("th",null,"留言",-1),Z={class:"col-md-8"},ee=e("h3",null,"訂單細節",-1),te={class:"table"},se=e("th",{style:{width:"100px"}},"訂單編號",-1),oe=e("th",null,"下單時間",-1),de=e("th",null,"付款時間",-1),le={key:0},ae=e("th",null,"付款狀態",-1),ne={key:0,class:"text-success"},re={key:1,class:"text-muted"},ie=e("h3",null,"選購商品",-1),ce={class:"table"},he=e("thead",null,[e("tr")],-1),ue={class:"text-end"},_e={class:"d-flex justify-content-end"},pe={class:"form-check"},me={class:"form-check-label",for:"flexCheckDefault"},be={key:0},ge={key:1},ye={class:"modal-footer"},fe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ke(t,n,a,v,s,c){return d(),l("div",q,[e("div",A,[F,e("div",I,[e("div",z,[e("div",G,[H,e("table",J,[s.order.user?(d(),l("tbody",K,[e("tr",null,[Q,e("td",null,o(s.order.user.name),1)]),e("tr",null,[R,e("td",null,o(s.order.user.email),1)]),e("tr",null,[W,e("td",null,o(s.order.user.tel),1)]),e("tr",null,[X,e("td",null,o(s.order.user.address),1)]),e("tr",null,[Y,e("td",null,o(s.order.message),1)])])):g("",!0)])]),e("div",Z,[ee,e("table",te,[e("tbody",null,[e("tr",null,[se,e("td",null,o(s.order.id),1)]),e("tr",null,[oe,e("td",null,o(t.$filters.date(s.order.create_at)),1)]),e("tr",null,[de,e("td",null,[s.order.paid_date?(d(),l("span",le,o(t.$filters.date(s.order.paid_date)),1)):g("",!0)])]),e("tr",null,[ae,e("td",null,[s.order.is_paid?(d(),l("strong",ne,"已付款")):(d(),l("span",re,"未付款"))])])])]),ie,e("table",ce,[he,e("tbody",null,[(d(!0),l(u,null,y(s.order.products,r=>(d(),l("tr",{key:r.id},[e("th",null,o(r.product.title),1),e("td",null,o(r.qty)+" / "+o(r.product.unit),1),e("td",ue,o(r.final_total),1)]))),128))])]),e("div",_e,[e("div",pe,[$(e("input",{type:"checkbox",class:"form-check-input",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=r=>s.order.is_paid=r)},null,512),[[C,s.order.is_paid]]),e("label",me,[s.order.is_paid?(d(),l("span",be,"已付款")):(d(),l("span",ge,"未付款"))])])])])])]),e("div",ye,[fe,e("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=(...r)=>a.updateOrder&&a.updateOrder(...r))}," 修改付款狀態 ")])])])}const Me=M(U,[["render",ke]]),ve="https://vue3-course-api.hexschool.io",Oe="hmjbs",k=D("ordersStore",{state:()=>({ordersData:[],page:{}}),actions:{getOrders(t=1){const n=`${ve}/v2/api/${Oe}/admin/orders?page=${t}`;P.get(n).then(a=>{this.ordersData=a.data.orders,this.page=a.data.pagination}).catch(a=>{console.log(a.response)})}},getters:{orders:({ordersData:t})=>t,pagination:({page:t})=>t}}),m="https://vue3-course-api.hexschool.io",b="hmjbs",we={components:{PaginationComponent:B,DeleteModal:T,OrderModal:Me},data(){return{tempOrder:{},deleteModal:null,orderModal:null}},methods:{addLoading(){const t=this.$loading.show();setTimeout(()=>{t.hide()},800)},updateOrder(){let t=`${m}/v2/api/${b}/admin/order`,n="post";this.isNew||(t=`${m}/v2/api/${b}/admin/order/${this.tempOrder.id}`,n="put"),this.axios[n](t,{data:this.tempOrder}).then(a=>{alert(a.data.message),this.orderModal.hide(),this.getOrders()}).catch(a=>{alert(a.data.message)})},deleteOrder(t){const n=`${m}/v2/api/${b}/admin/order/${t}`;this.axios.delete(n).then(a=>{alert(a.data.message),this.deleteModal.hide(),this.getOrders()}).catch(a=>{alert(a.data.message)})},openModal(t,n){t==="delete"?(this.tempOrder={...n},this.deleteModal.show()):t==="edit"&&(this.tempOrder={...n},this.orderModal.show())},...V(k,["getOrders"])},computed:{...E(k,["orders","pagination"])},mounted(){this.addLoading(),this.getOrders(),this.deleteModal=new f("#deleteModal"),this.orderModal=new f("#orderModal")}},xe=e("h1",{class:"h2 fw-bold my-4"},"訂單管理",-1),$e={class:"table table-hover mt-4"},Ce=e("thead",{class:"table-dark"},[e("tr",null,[e("th",{width:"120"}," 購買時間 "),e("th",null,"Email"),e("th",{width:"120"}," 購買品項 "),e("th",{width:"120"}," 應付金額 "),e("th",{width:"100"}," 是否付款 "),e("th",{width:"120"}," 編輯 ")])],-1),De={class:"list-unstyled"},Pe={key:0,class:"text-success"},Ve={key:1,class:"text-muted"},Ee={class:"btn-group"},Le=["onClick"],Ne=["onClick"],Se={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},je={id:"deleteModal",ref:"deleteModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"};function Be(t,n,a,v,s,c){const r=_("pagination-component"),O=_("order-modal"),w=_("delete-modal");return d(),l(u,null,[(d(),L(S,{to:"title"},[N(" | 訂單管理")])),xe,e("table",$e,[Ce,e("tbody",null,[(d(!0),l(u,null,y(t.orders,i=>(d(),l(u,{key:i.id},[t.orders.length?(d(),l("tr",{key:0,class:j({"text-secondary":!i.is_paid})},[e("td",null,o(t.$filters.date(i.create_at)),1),e("td",null,o(i.user.email),1),e("td",null,[e("ul",De,[(d(!0),l(u,null,y(i.products,(h,x)=>(d(),l("li",{key:x},o(h.product.title)+" 數量："+o(h.qty)+" "+o(h.product.unit),1))),128))])]),e("td",null,o(i.total),1),e("td",null,[i.is_paid?(d(),l("span",Pe,"已付款")):(d(),l("span",Ve,"未付款"))]),e("td",null,[e("div",Ee,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:h=>c.openModal("edit",i)}," 檢視 ",8,Le),e("button",{type:"button",class:"btn btn-outline-danger btn-sm","data-bs-toggle":"modal","data-bs-target":"#deleteModal",onClick:h=>c.openModal("delete",i)}," 刪除 ",8,Ne)])])],2)):g("",!0)],64))),128))])]),p(r,{onEmitPages:t.getOrders,pages:t.pagination},null,8,["onEmitPages","pages"]),e("div",Se,[p(O,{"temp-order":s.tempOrder,"update-order":c.updateOrder},null,8,["temp-order","update-order"])],512),e("div",je,[p(w,{item:s.tempOrder,onDelItem:c.deleteOrder},null,8,["item","onDelItem"])],512)],64)}const qe=M(we,[["render",Be]]);export{qe as default};
